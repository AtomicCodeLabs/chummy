{"version":3,"sources":["webpack:///./node_modules/@firebase/messaging/dist/index.esm.js"],"names":["MessageType","ERROR_MAP","ERROR_FACTORY","DEFAULT_VAPID_KEY","arrayToBase64","array","uint8Array","Uint8Array","btoa","String","fromCharCode","apply","replace","base64ToArray","base64String","base64","repeat","length","rawData","atob","outputArray","i","charCodeAt","migrateOldDatabase","senderId","this","databases","tokenDetails","_this","_a","label","indexedDB","sent","map","db","name","includes","objectStore","value","oldDetails","_b","oldVersion","objectStoreNames","contains","transaction","index","get","clear","auth","p256dh","endpoint","token","fcmToken","createTime","Date","now","subscriptionOptions","swScope","vapidKey","close","checkTokenDetails","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDb","createObjectStore","dbGet","firebaseDependencies","key","oldTokenDetails","getKey","appConfig","dbSet","tx","put","complete","dbRemove","delete","appId","requestGetToken","headers","body","subscribeOptions","responseData","err_1","message","getHeaders","getBody","method","JSON","stringify","trys","push","fetch","getEndpoint","json","create","errorInfo","error","requestUpdateToken","updateOptions","err_2","requestDeleteToken","unsubscribeOptions","err_3","ENDPOINT","projectId","installations","authToken","getToken","Headers","Accept","apiKey","web","applicationPubKey","swRegistration","pushSubscription","e_1","Notification","permission","getPushSubscription","scope","getNewToken","dbOptions","isVapidKeyEqual","currentOptions","isEndpointEqual","isAuthEqual","isP256dhEqual","console","warn","updateToken","deleteToken","pushManager","getSubscription","unsubscribe","updatedToken","updatedTokenDetails","e_2","subscription","subscribe","userVisibleOnly","applicationServerKey","isConsoleMessage","data","sleep","ms","Promise","resolve","setTimeout","SwController","isOnBackgroundMessageUsed","bgMessageHandler","self","addEventListener","e","waitUntil","onPush","onSubChange","onNotificationClick","Object","defineProperty","prototype","app","enumerable","configurable","setBackgroundMessageHandler","callback","onBackgroundMessage","nextOrObserver","_c","registration","requestPermission","usePublicVapidKey","useServiceWorker","onMessage","onTokenRefresh","event","internalPayload","clientList","isNotificationShown","payload","err","getMessagePayloadInternal","getClientList","debug","TAG","some","client","visibilityState","url","startsWith","hasVisibleClients","sendMessagePayloadInternalToWindows","notification","showNotification","wrapInternalPayload","from","collapseKey","collapse_key","messagePayloadInternal","title","image","propagateNotificationPayload","propagateDataPayload","fcmOptions","link","analyticsLabel","analytics_label","propagateFcmOptions","externalizePayload","next","newSubscription","originUrl","action","stopImmediatePropagation","click_action","location","origin","getLink","URL","href","host","getWindowClient","clients","openWindow","focus","messageType","NOTIFICATION_CLICKED","isFirebaseMessaging","postMessage","wrappedInternalPayload","clientList_1","clientList_1_1","clientUrl","done","e_1_1","return","call","PUSH_RECEIVED","clientList_2","clientList_2_1","e_2_1","matchAll","type","includeUncontrolled","notificationPayloadInternal","actions","maxActions","WindowController","onMessageCallback","navigator","serviceWorker","messageEventListener","dataPayload","stripInternalFields","assign","logEvent","getVapidKey","getSwReg","options","updateVapidKey","updateSwReg","serviceWorkerRegistration","registerDefaultSw","ServiceWorkerRegistration","register","update","catch","browserErrorMessage","permissionResult","eventType","Error","getEventType","analyticsProvider","message_id","message_name","message_time","message_device_time","Math","floor","getMissingValueError","valueName","NAMESPACE_EXPORTS","isSupported","hasOwnProperty","PushSubscription","window","cookieEnabled","INTERNAL","registerComponent","container","getProvider","getImmediate","configKeys_1","configKeys_1_1","keyName","appName","messagingSenderId","extractAppConfig","setServiceProps"],"mappings":"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","file":"17-6a9bcc35bbf4eddc7d2c.js","sourcesContent":["import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory } from '@firebase/util';\nimport { __spread, __awaiter, __generator, __assign, __values } from 'tslib';\nimport { deleteDb, openDb } from 'idb';\nimport firebase from '@firebase/app';\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"only-available-in-window\"\n/* AVAILABLE_IN_WINDOW */\n] = 'This method is available in a Window context.', _a[\"only-available-in-sw\"\n/* AVAILABLE_IN_SW */\n] = 'This method is available in a service worker context.', _a[\"permission-default\"\n/* PERMISSION_DEFAULT */\n] = 'The notification permission was not granted and dismissed instead.', _a[\"permission-blocked\"\n/* PERMISSION_BLOCKED */\n] = 'The notification permission was not granted and blocked instead.', _a[\"unsupported-browser\"\n/* UNSUPPORTED_BROWSER */\n] = \"This browser doesn't support the API's required to use the firebase SDK.\", _a[\"failed-service-worker-registration\"\n/* FAILED_DEFAULT_REGISTRATION */\n] = 'We are unable to register the default service worker. {$browserErrorMessage}', _a[\"token-subscribe-failed\"\n/* TOKEN_SUBSCRIBE_FAILED */\n] = 'A problem occurred while subscribing the user to FCM: {$errorInfo}', _a[\"token-subscribe-no-token\"\n/* TOKEN_SUBSCRIBE_NO_TOKEN */\n] = 'FCM returned no token when subscribing the user to push.', _a[\"token-unsubscribe-failed\"\n/* TOKEN_UNSUBSCRIBE_FAILED */\n] = 'A problem occurred while unsubscribing the ' + 'user from FCM: {$errorInfo}', _a[\"token-update-failed\"\n/* TOKEN_UPDATE_FAILED */\n] = 'A problem occurred while updating the user from FCM: {$errorInfo}', _a[\"token-update-no-token\"\n/* TOKEN_UPDATE_NO_TOKEN */\n] = 'FCM returned no token when updating the user to push.', _a[\"use-sw-after-get-token\"\n/* USE_SW_AFTER_GET_TOKEN */\n] = 'The useServiceWorker() method may only be called once and must be ' + 'called before calling getToken() to ensure your service worker is used.', _a[\"invalid-sw-registration\"\n/* INVALID_SW_REGISTRATION */\n] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.', _a[\"invalid-bg-handler\"\n/* INVALID_BG_HANDLER */\n] = 'The input to setBackgroundMessageHandler() must be a function.', _a[\"invalid-vapid-key\"\n/* INVALID_VAPID_KEY */\n] = 'The public VAPID key must be a string.', _a[\"use-vapid-key-after-get-token\"\n/* USE_VAPID_KEY_AFTER_GET_TOKEN */\n] = 'The usePublicVapidKey() method may only be called once and must be ' + 'called before calling getToken() to ensure your VAPID key is used.', _a);\nvar ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1'; // Key of FCM Payload in Notification's data field.\n\nvar FCM_MSG = 'FCM_MSG';\nvar TAG = 'FirebaseMessaging: '; // Set to '1' if Analytics is enabled for the campaign\n\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l'; // Due to the fact that onBackgroundMessage can't be awaited (to support rxjs), a silent push\n// warning might be shown by the browser if the callback fails to completes by the end of onPush.\n// Experiments were ran to determine the majority onBackground message clock time. This brief\n// blocking time would allow majority of the onBackgroundMessage callback to finish.\n\nvar BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS = 1000; // Preparation time for client to initialize and set up the message handler.\n\nvar FOREGROUND_HANDLE_PREPARATION_TIME_MS = 3000;\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\n\nvar MessageType;\n\n(function (MessageType) {\n  MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\n  MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction arrayToBase64(array) {\n  var uint8Array = new Uint8Array(array);\n  var base64String = btoa(String.fromCharCode.apply(String, __spread(uint8Array)));\n  return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nfunction base64ToArray(base64String) {\n  var padding = '='.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar OLD_DB_NAME = 'fcm_token_details_db';\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\n\nvar OLD_DB_VERSION = 5;\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\n\nfunction migrateOldDatabase(senderId) {\n  return __awaiter(this, void 0, void 0, function () {\n    var databases, dbNames, tokenDetails, db;\n\n    var _this = this;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!('databases' in indexedDB)) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , indexedDB.databases()];\n\n        case 1:\n          databases = _a.sent();\n          dbNames = databases.map(function (db) {\n            return db.name;\n          });\n\n          if (!dbNames.includes(OLD_DB_NAME)) {\n            // old DB didn't exist, no need to open.\n            return [2\n            /*return*/\n            , null];\n          }\n\n          _a.label = 2;\n\n        case 2:\n          tokenDetails = null;\n          return [4\n          /*yield*/\n          , openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var objectStore, value, oldDetails, oldDetails, oldDetails;\n\n              var _a;\n\n              return __generator(this, function (_b) {\n                switch (_b.label) {\n                  case 0:\n                    if (db.oldVersion < 2) {\n                      // Database too old, skip migration.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n                      // Database did not exist. Nothing to do.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\n                    return [4\n                    /*yield*/\n                    , objectStore.index('fcmSenderId').get(senderId)];\n\n                  case 1:\n                    value = _b.sent();\n                    return [4\n                    /*yield*/\n                    , objectStore.clear()];\n\n                  case 2:\n                    _b.sent();\n\n                    if (!value) {\n                      // No entry in the database, nothing to migrate.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (db.oldVersion === 2) {\n                      oldDetails = value;\n\n                      if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\n                        return [2\n                        /*return*/\n                        ];\n                      }\n\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\n                        subscriptionOptions: {\n                          auth: oldDetails.auth,\n                          p256dh: oldDetails.p256dh,\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: typeof oldDetails.vapidKey === 'string' ? oldDetails.vapidKey : arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 3) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 4) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          })];\n\n        case 3:\n          db = _a.sent();\n          db.close(); // Delete all old databases.\n\n          return [4\n          /*yield*/\n          , deleteDb(OLD_DB_NAME)];\n\n        case 4:\n          // Delete all old databases.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('fcm_vapid_details_db')];\n\n        case 5:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('undefined')];\n\n        case 6:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , checkTokenDetails(tokenDetails) ? tokenDetails : null];\n      }\n    });\n  });\n}\n\nfunction checkTokenDetails(tokenDetails) {\n  if (!tokenDetails || !tokenDetails.subscriptionOptions) {\n    return false;\n  }\n\n  var subscriptionOptions = tokenDetails.subscriptionOptions;\n  return typeof tokenDetails.createTime === 'number' && tokenDetails.createTime > 0 && typeof tokenDetails.token === 'string' && tokenDetails.token.length > 0 && typeof subscriptionOptions.auth === 'string' && subscriptionOptions.auth.length > 0 && typeof subscriptionOptions.p256dh === 'string' && subscriptionOptions.p256dh.length > 0 && typeof subscriptionOptions.endpoint === 'string' && subscriptionOptions.endpoint.length > 0 && typeof subscriptionOptions.swScope === 'string' && subscriptionOptions.swScope.length > 0 && typeof subscriptionOptions.vapidKey === 'string' && subscriptionOptions.vapidKey.length > 0;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Exported for tests.\n\n\nvar DATABASE_NAME = 'firebase-messaging-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\n      // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\n      // because if there are multiple versions between the old version and the current version, we\n      // want ALL the migrations that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDb.oldVersion) {\n        case 0:\n          upgradeDb.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Gets record(s) from the objectStore that match the given key. */\n\n\nfunction dbGet(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tokenDetails, oldTokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          return [4\n          /*yield*/\n          , db.transaction(OBJECT_STORE_NAME).objectStore(OBJECT_STORE_NAME).get(key)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 3];\n          return [2\n          /*return*/\n          , tokenDetails];\n\n        case 3:\n          return [4\n          /*yield*/\n          , migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\n\n        case 4:\n          oldTokenDetails = _a.sent();\n          if (!oldTokenDetails) return [3\n          /*break*/\n          , 6];\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, oldTokenDetails)];\n\n        case 5:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , oldTokenDetails];\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction dbSet(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction dbRemove(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getKey(_a) {\n  var appConfig = _a.appConfig;\n  return appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, subscribeOptions, responseData, response, err_1, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(subscriptionOptions);\n          subscribeOptions = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_1 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n          /* TOKEN_SUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_1\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n            /* TOKEN_SUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-subscribe-no-token\"\n            /* TOKEN_SUBSCRIBE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, updateOptions, responseData, response, err_2, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(tokenDetails.subscriptionOptions);\n          updateOptions = {\n            method: 'PATCH',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_2 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-update-failed\"\n          /* TOKEN_UPDATE_FAILED */\n          , {\n            errorInfo: err_2\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-update-failed\"\n            /* TOKEN_UPDATE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-update-no-token\"\n            /* TOKEN_UPDATE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestDeleteToken(firebaseDependencies, token) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, unsubscribeOptions, response, responseData, message, err_3;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          unsubscribeOptions = {\n            method: 'DELETE',\n            headers: headers\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n            /* TOKEN_UNSUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_3 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n          /* TOKEN_UNSUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_3\n          });\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getEndpoint(_a) {\n  var projectId = _a.projectId;\n  return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\n}\n\nfunction getHeaders(_a) {\n  var appConfig = _a.appConfig,\n      installations = _a.installations;\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , installations.getToken()];\n\n        case 1:\n          authToken = _b.sent();\n          return [2\n          /*return*/\n          , new Headers({\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'x-goog-api-key': appConfig.apiKey,\n            'x-goog-firebase-installations-auth': \"FIS \" + authToken\n          })];\n      }\n    });\n  });\n}\n\nfunction getBody(_a) {\n  var p256dh = _a.p256dh,\n      auth = _a.auth,\n      endpoint = _a.endpoint,\n      vapidKey = _a.vapidKey;\n  var body = {\n    web: {\n      endpoint: endpoint,\n      auth: auth,\n      p256dh: p256dh\n    }\n  };\n\n  if (vapidKey !== DEFAULT_VAPID_KEY) {\n    body.web.applicationPubKey = vapidKey;\n  }\n\n  return body;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** UpdateRegistration will be called once every week. */\n\n\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var pushSubscription, tokenDetails, subscriptionOptions, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (Notification.permission !== 'granted') {\n            throw ERROR_FACTORY.create(\"permission-blocked\"\n            /* PERMISSION_BLOCKED */\n            );\n          }\n\n          return [4\n          /*yield*/\n          , getPushSubscription(swRegistration, vapidKey)];\n\n        case 1:\n          pushSubscription = _a.sent();\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          subscriptionOptions = {\n            vapidKey: vapidKey,\n            swScope: swRegistration.scope,\n            endpoint: pushSubscription.endpoint,\n            auth: arrayToBase64(pushSubscription.getKey('auth')),\n            p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\n          };\n          if (!!tokenDetails) return [3\n          /*break*/\n          , 3]; // No token, get a new one.\n\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 3:\n          if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3\n          /*break*/\n          , 8];\n          _a.label = 4;\n\n        case 4:\n          _a.trys.push([4, 6,, 7]);\n\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 5:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 6:\n          e_1 = _a.sent(); // Suppress errors because of #2364\n\n          console.warn(e_1);\n          return [3\n          /*break*/\n          , 7];\n\n        case 7:\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 8:\n          if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\n            // Weekly token refresh\n            return [2\n            /*return*/\n            , updateToken({\n              token: tokenDetails.token,\n              createTime: Date.now(),\n              subscriptionOptions: subscriptionOptions\n            }, firebaseDependencies, swRegistration)];\n          } else {\n            // Valid token, nothing to do.\n            return [2\n            /*return*/\n            , tokenDetails.token];\n          }\n\n        case 9:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\n\n\nfunction deleteToken(firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenDetails, pushSubscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 1:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , dbRemove(firebaseDependencies)];\n\n        case 3:\n          _a.sent();\n\n          _a.label = 4;\n\n        case 4:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 5:\n          pushSubscription = _a.sent();\n\n          if (pushSubscription) {\n            return [2\n            /*return*/\n            , pushSubscription.unsubscribe()];\n          } // If there's no SW, consider it a success.\n\n\n          return [2\n          /*return*/\n          , true];\n      }\n    });\n  });\n}\n\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var updatedToken, updatedTokenDetails, e_2;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 5]);\n\n          return [4\n          /*yield*/\n          , requestUpdateToken(firebaseDependencies, tokenDetails)];\n\n        case 1:\n          updatedToken = _a.sent();\n          updatedTokenDetails = __assign(__assign({}, tokenDetails), {\n            token: updatedToken,\n            createTime: Date.now()\n          });\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, updatedTokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , updatedToken];\n\n        case 3:\n          e_2 = _a.sent();\n          return [4\n          /*yield*/\n          , deleteToken(firebaseDependencies, swRegistration)];\n\n        case 4:\n          _a.sent();\n\n          throw e_2;\n\n        case 5:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var token, tokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , requestGetToken(firebaseDependencies, subscriptionOptions)];\n\n        case 1:\n          token = _a.sent();\n          tokenDetails = {\n            token: token,\n            createTime: Date.now(),\n            subscriptionOptions: subscriptionOptions\n          };\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, tokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails.token];\n      }\n    });\n  });\n}\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\n\n\nfunction getPushSubscription(swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var subscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 1:\n          subscription = _a.sent();\n\n          if (subscription) {\n            return [2\n            /*return*/\n            , subscription];\n          }\n\n          return [2\n          /*return*/\n          , swRegistration.pushManager.subscribe({\n            userVisibleOnly: true,\n            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\n            // submitted to pushManager#subscribe must be of type Uint8Array.\n            applicationServerKey: base64ToArray(vapidKey)\n          })];\n      }\n    });\n  });\n}\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\n\n\nfunction isTokenValid(dbOptions, currentOptions) {\n  var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\n  var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\n  var isAuthEqual = currentOptions.auth === dbOptions.auth;\n  var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\n  return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction externalizePayload(internalPayload) {\n  var payload = {\n    from: internalPayload.from,\n    // eslint-disable-next-line camelcase\n    collapseKey: internalPayload.collapse_key\n  };\n  propagateNotificationPayload(payload, internalPayload);\n  propagateDataPayload(payload, internalPayload);\n  propagateFcmOptions(payload, internalPayload);\n  return payload;\n}\n\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.notification) {\n    return;\n  }\n\n  payload.notification = {};\n  var title = messagePayloadInternal.notification.title;\n\n  if (!!title) {\n    payload.notification.title = title;\n  }\n\n  var body = messagePayloadInternal.notification.body;\n\n  if (!!body) {\n    payload.notification.body = body;\n  }\n\n  var image = messagePayloadInternal.notification.image;\n\n  if (!!image) {\n    payload.notification.image = image;\n  }\n}\n\nfunction propagateDataPayload(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.data) {\n    return;\n  }\n\n  payload.data = messagePayloadInternal.data;\n}\n\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.fcmOptions) {\n    return;\n  }\n\n  payload.fcmOptions = {};\n  var link = messagePayloadInternal.fcmOptions.link;\n\n  if (!!link) {\n    payload.fcmOptions.link = link;\n  } // eslint-disable-next-line camelcase\n\n\n  var analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\n\n  if (!!analyticsLabel) {\n    payload.fcmOptions.analyticsLabel = analyticsLabel;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction isConsoleMessage(data) {\n  // This message has a campaign ID, meaning it was sent using the Firebase Console.\n  return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar SwController =\n/** @class */\nfunction () {\n  function SwController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies; // A boolean flag to determine wether an app is using onBackgroundMessage or\n    // setBackgroundMessageHandler. onBackgroundMessage will receive a MessagePayload regardless of if\n    // a notification is displayed. Whereas, setBackgroundMessageHandler will swallow the\n    // MessagePayload if a NotificationPayload is included.\n\n    this.isOnBackgroundMessageUsed = null;\n    this.vapidKey = null;\n    this.bgMessageHandler = null;\n    self.addEventListener('push', function (e) {\n      e.waitUntil(_this.onPush(e));\n    });\n    self.addEventListener('pushsubscriptionchange', function (e) {\n      e.waitUntil(_this.onSubChange(e));\n    });\n    self.addEventListener('notificationclick', function (e) {\n      e.waitUntil(_this.onNotificationClick(e));\n    });\n  }\n\n  Object.defineProperty(SwController.prototype, \"app\", {\n    get: function get() {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * @deprecated. Use onBackgroundMessage(nextOrObserver: NextFn<object> | Observer<object>):\r\n   * Unsubscribe instead.\r\n   *\r\n   * Calling setBackgroundMessageHandler will opt in to some specific behaviors.\r\n   *\r\n   * 1.) If a notification doesn't need to be shown due to a window already being visible, then push\r\n   * messages will be sent to the page. 2.) If a notification needs to be shown, and the message\r\n   * contains no notification data this method will be called and the promise it returns will be\r\n   * passed to event.waitUntil. If you do not set this callback then all push messages will let and\r\n   * the developer can handle them in a their own 'push' event callback\r\n   *\r\n   * @param callback The callback to be called when a push message is received and a notification\r\n   * must be shown. The callback will be given the data from the push message.\r\n   */\n\n  SwController.prototype.setBackgroundMessageHandler = function (callback) {\n    this.isOnBackgroundMessageUsed = false;\n\n    if (!callback || typeof callback !== 'function') {\n      throw ERROR_FACTORY.create(\"invalid-bg-handler\"\n      /* INVALID_BG_HANDLER */\n      );\n    }\n\n    this.bgMessageHandler = callback;\n  };\n\n  SwController.prototype.onBackgroundMessage = function (nextOrObserver) {\n    var _this = this;\n\n    this.isOnBackgroundMessageUsed = true;\n    this.bgMessageHandler = nextOrObserver;\n    return function () {\n      _this.bgMessageHandler = null;\n    };\n  }; // TODO: Remove getToken from SW Controller. Calling this from an old SW can cause all kinds of\n  // trouble.\n\n\n  SwController.prototype.getToken = function () {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenDetails;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (!!this.vapidKey) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 1:\n            tokenDetails = _c.sent();\n            this.vapidKey = (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\n            _c.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\n        }\n      });\n    });\n  }; // TODO: Remove deleteToken from SW Controller. Calling this from an old SW can cause all kinds of\n  // trouble.\n\n\n  SwController.prototype.deleteToken = function () {\n    return deleteToken(this.firebaseDependencies, self.registration);\n  };\n\n  SwController.prototype.requestPermission = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  }; // TODO: Remove this together with getToken from SW Controller.\n\n\n  SwController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n\n  SwController.prototype.useServiceWorker = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onMessage = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onTokenRefresh = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n  /**\r\n   * A handler for push events that shows notifications based on the content of the payload.\r\n   *\r\n   * The payload must be a JSON-encoded Object with a `notification` key. The value of the\r\n   * `notification` property will be used as the NotificationOptions object passed to\r\n   * showNotification. Additionally, the `title` property of the notification object will be used as\r\n   * the title.\r\n   *\r\n   * If there is no notification data in the payload then no notification will be shown.\r\n   */\n\n\n  SwController.prototype.onPush = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, clientList, isNotificationShown, payload;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            internalPayload = getMessagePayloadInternal(event);\n\n            if (!internalPayload) {\n              console.debug(TAG + 'failed to get parsed MessagePayload from the PushEvent. Skip handling the push.');\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n\n            if (hasVisibleClients(clientList)) {\n              return [2\n              /*return*/\n              , sendMessagePayloadInternalToWindows(clientList, internalPayload)];\n            }\n\n            isNotificationShown = false;\n            if (!!!internalPayload.notification) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , showNotification(wrapInternalPayload(internalPayload))];\n\n          case 2:\n            _a.sent();\n\n            isNotificationShown = true;\n            _a.label = 3;\n\n          case 3:\n            // MessagePayload is only passed to `onBackgroundMessage`. Skip passing MessagePayload for\n            // the legacy `setBackgroundMessageHandler` to preserve the SDK behaviors.\n            if (isNotificationShown === true && this.isOnBackgroundMessageUsed === false) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!!this.bgMessageHandler) {\n              payload = externalizePayload(internalPayload);\n\n              if (typeof this.bgMessageHandler === 'function') {\n                this.bgMessageHandler(payload);\n              } else {\n                this.bgMessageHandler.next(payload);\n              }\n            } // wait briefly to allow onBackgroundMessage to complete\n\n\n            return [4\n            /*yield*/\n            , sleep(BACKGROUND_HANDLE_EXECUTION_TIME_LIMIT_MS)];\n\n          case 4:\n            // wait briefly to allow onBackgroundMessage to complete\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onSubChange = function (event) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var newSubscription, tokenDetails;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            newSubscription = event.newSubscription;\n            if (!!newSubscription) return [3\n            /*break*/\n            , 2]; // Subscription revoked, delete token\n\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 1:\n            // Subscription revoked, delete token\n            _c.sent();\n\n            return [2\n            /*return*/\n            ];\n\n          case 2:\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 3:\n            tokenDetails = _c.sent();\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 4:\n            _c.sent();\n\n            return [4\n            /*yield*/\n            , getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\n\n          case 5:\n            _c.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onNotificationClick = function (event) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, link, url, originUrl, client;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            internalPayload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\n\n            if (!internalPayload) {\n              return [2\n              /*return*/\n              ];\n            } else if (event.action) {\n              // User clicked on an action button. This will allow developers to act on action button clicks\n              // by using a custom onNotificationClick listener that they define.\n              return [2\n              /*return*/\n              ];\n            } // Prevent other listeners from receiving the event\n\n\n            event.stopImmediatePropagation();\n            event.notification.close();\n            link = getLink(internalPayload);\n\n            if (!link) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            url = new URL(link, self.location.href);\n            originUrl = new URL(self.location.origin);\n\n            if (url.host !== originUrl.host) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getWindowClient(url)];\n\n          case 1:\n            client = _c.sent();\n            if (!!client) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , self.clients.openWindow(link)];\n\n          case 2:\n            client = _c.sent(); // Wait three seconds for the client to initialize and set up the message handler so that it\n            // can receive the message.\n\n            return [4\n            /*yield*/\n            , sleep(FOREGROUND_HANDLE_PREPARATION_TIME_MS)];\n\n          case 3:\n            // Wait three seconds for the client to initialize and set up the message handler so that it\n            // can receive the message.\n            _c.sent();\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 4:\n            return [4\n            /*yield*/\n            , client.focus()];\n\n          case 5:\n            client = _c.sent();\n            _c.label = 6;\n\n          case 6:\n            if (!client) {\n              // Window Client will not be returned if it's for a third party origin.\n              return [2\n              /*return*/\n              ];\n            }\n\n            internalPayload.messageType = MessageType.NOTIFICATION_CLICKED;\n            internalPayload.isFirebaseMessaging = true;\n            return [2\n            /*return*/\n            , client.postMessage(internalPayload)];\n        }\n      });\n    });\n  };\n\n  return SwController;\n}();\n\nfunction wrapInternalPayload(internalPayload) {\n  var _a;\n\n  var wrappedInternalPayload = __assign({}, internalPayload.notification); // Put the message payload under FCM_MSG name so we can identify the notification as being an FCM\n  // notification vs a notification from somewhere else (i.e. normal web push or developer generated\n  // notification).\n\n\n  wrappedInternalPayload.data = (_a = {}, _a[FCM_MSG] = internalPayload, _a);\n  return wrappedInternalPayload;\n}\n\nfunction getMessagePayloadInternal(_a) {\n  var data = _a.data;\n\n  if (!data) {\n    return null;\n  }\n\n  try {\n    return data.json();\n  } catch (err) {\n    // Not JSON so not an FCM message.\n    return null;\n  }\n}\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\n\n\nfunction getWindowClient(url) {\n  return __awaiter(this, void 0, void 0, function () {\n    var clientList, clientList_1, clientList_1_1, client, clientUrl;\n\n    var e_1, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getClientList()];\n\n        case 1:\n          clientList = _b.sent();\n\n          try {\n            for (clientList_1 = __values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\n              client = clientList_1_1.value;\n              clientUrl = new URL(client.url, self.location.href);\n\n              if (url.host === clientUrl.host) {\n                return [2\n                /*return*/\n                , client];\n              }\n            }\n          } catch (e_1_1) {\n            e_1 = {\n              error: e_1_1\n            };\n          } finally {\n            try {\n              if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\n            } finally {\n              if (e_1) throw e_1.error;\n            }\n          }\n\n          return [2\n          /*return*/\n          , null];\n      }\n    });\n  });\n}\n/**\r\n * @returns If there is currently a visible WindowClient, this method will resolve to true,\r\n * otherwise false.\r\n */\n\n\nfunction hasVisibleClients(clientList) {\n  return clientList.some(function (client) {\n    return client.visibilityState === 'visible' && // Ignore chrome-extension clients as that matches the background pages of extensions, which\n    // are always considered visible for some reason.\n    !client.url.startsWith('chrome-extension://');\n  });\n}\n\nfunction sendMessagePayloadInternalToWindows(clientList, internalPayload) {\n  var e_2, _a;\n\n  internalPayload.isFirebaseMessaging = true;\n  internalPayload.messageType = MessageType.PUSH_RECEIVED;\n\n  try {\n    for (var clientList_2 = __values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\n      var client = clientList_2_1.value;\n      client.postMessage(internalPayload);\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n}\n\nfunction getClientList() {\n  return self.clients.matchAll({\n    type: 'window',\n    includeUncontrolled: true // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\n\n  });\n}\n\nfunction showNotification(notificationPayloadInternal) {\n  var _a; // Note: Firefox does not support the maxActions property.\n  // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\n\n\n  var actions = notificationPayloadInternal.actions;\n  var maxActions = Notification.maxActions;\n\n  if (actions && maxActions && actions.length > maxActions) {\n    console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\n  }\n\n  return self.registration.showNotification((_a =\n  /* title= */\n  notificationPayloadInternal.title) !== null && _a !== void 0 ? _a : '', notificationPayloadInternal);\n}\n\nfunction getLink(payload) {\n  var _a, _b, _c; // eslint-disable-next-line camelcase\n\n\n  var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\n\n  if (link) {\n    return link;\n  }\n\n  if (isConsoleMessage(payload.data)) {\n    // Notification created in the Firebase Console. Redirect to origin.\n    return self.location.origin;\n  } else {\n    return null;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar WindowController =\n/** @class */\nfunction () {\n  function WindowController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies;\n    this.vapidKey = null;\n    this.onMessageCallback = null;\n    navigator.serviceWorker.addEventListener('message', function (e) {\n      return _this.messageEventListener(e);\n    });\n  }\n\n  Object.defineProperty(WindowController.prototype, \"app\", {\n    get: function get() {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  WindowController.prototype.messageEventListener = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, dataPayload;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            internalPayload = event.data;\n\n            if (!internalPayload.isFirebaseMessaging) {\n              return [2\n              /*return*/\n              ];\n            } // onMessageCallback is either a function or observer/subscriber.\n            // TODO: in the modularization release, have onMessage handle type MessagePayload as supposed to\n            // the legacy payload where some fields are in snake cases.\n\n\n            if (this.onMessageCallback && internalPayload.messageType === MessageType.PUSH_RECEIVED) {\n              if (typeof this.onMessageCallback === 'function') {\n                this.onMessageCallback(stripInternalFields(Object.assign({}, internalPayload)));\n              } else {\n                this.onMessageCallback.next(Object.assign({}, internalPayload));\n              }\n            }\n\n            dataPayload = internalPayload.data;\n            if (!(isConsoleMessage(dataPayload) && dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.logEvent(internalPayload.messageType, dataPayload)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.getVapidKey = function () {\n    return this.vapidKey;\n  };\n\n  WindowController.prototype.getSwReg = function () {\n    return this.swRegistration;\n  };\n\n  WindowController.prototype.getToken = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!(Notification.permission === 'default')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            if (Notification.permission !== 'granted') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.updateVapidKey(options === null || options === void 0 ? void 0 : options.vapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.updateSwReg(options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration)];\n\n          case 4:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, this.swRegistration, this.vapidKey)];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.updateVapidKey = function (vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!!vapidKey) {\n          this.vapidKey = vapidKey;\n        } else if (!this.vapidKey) {\n          this.vapidKey = DEFAULT_VAPID_KEY;\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  WindowController.prototype.updateSwReg = function (swRegistration) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!(!swRegistration && !this.swRegistration)) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.registerDefaultSw()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            if (!swRegistration && !!this.swRegistration) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n              throw ERROR_FACTORY.create(\"invalid-sw-registration\"\n              /* INVALID_SW_REGISTRATION */\n              );\n            }\n\n            this.swRegistration = swRegistration;\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.registerDefaultSw = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, e_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _b.trys.push([0, 2,, 3]);\n\n            _a = this;\n            return [4\n            /*yield*/\n            , navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n              scope: DEFAULT_SW_SCOPE\n            })];\n\n          case 1:\n            _a.swRegistration = _b.sent(); // The timing when browser updates sw when sw has an update is unreliable by my experiment. It\n            // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\n            // is stuck with the old version. For example,\n            // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\n            // sw if there was an update.\n\n            this.swRegistration.update().catch(function () {\n              /* it is non blocking and we don't care if it failed */\n            });\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            e_1 = _b.sent();\n            throw ERROR_FACTORY.create(\"failed-service-worker-registration\"\n            /* FAILED_DEFAULT_REGISTRATION */\n            , {\n              browserErrorMessage: e_1.message\n            });\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.deleteToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!this.swRegistration) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.registerDefaultSw()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , deleteToken(this.firebaseDependencies, this.swRegistration)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Request permission if it is not currently granted.\r\n   *\r\n   * @return Resolves if the permission was granted, rejects otherwise.\r\n   *\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  WindowController.prototype.requestPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permissionResult;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (Notification.permission === 'granted') {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            permissionResult = _a.sent();\n\n            if (permissionResult === 'granted') {\n              return [2\n              /*return*/\n              ];\n            } else if (permissionResult === 'denied') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            } else {\n              throw ERROR_FACTORY.create(\"permission-default\"\n              /* PERMISSION_DEFAULT */\n              );\n            }\n\n        }\n      });\n    });\n  };\n  /**\r\n   * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n   * ServiceWorkerRegistration;}): Promise<string> instead.\r\n   */\n\n\n  WindowController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n  /**\r\n   * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n   * ServiceWorkerRegistration;}): Promise<string> instead.\r\n   */\n\n\n  WindowController.prototype.useServiceWorker = function (swRegistration) {\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n      throw ERROR_FACTORY.create(\"invalid-sw-registration\"\n      /* INVALID_SW_REGISTRATION */\n      );\n    }\n\n    if (this.swRegistration) {\n      throw ERROR_FACTORY.create(\"use-sw-after-get-token\"\n      /* USE_SW_AFTER_GET_TOKEN */\n      );\n    }\n\n    this.swRegistration = swRegistration;\n  };\n  /**\r\n   * @param nextOrObserver An observer object or a function triggered on message.\r\n   *\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onMessage = function (nextOrObserver) {\n    var _this = this;\n\n    this.onMessageCallback = nextOrObserver;\n    return function () {\n      _this.onMessageCallback = null;\n    };\n  };\n\n  WindowController.prototype.setBackgroundMessageHandler = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  };\n\n  WindowController.prototype.onBackgroundMessage = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  };\n  /**\r\n   * @deprecated No-op. It was initially designed with token rotation requests from server in mind.\r\n   * However, the plan to implement such feature was abandoned.\r\n   */\n\n\n  WindowController.prototype.onTokenRefresh = function () {\n    return function () {};\n  };\n\n  WindowController.prototype.logEvent = function (messageType, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var eventType, analytics;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            eventType = getEventType(messageType);\n            return [4\n            /*yield*/\n            , this.firebaseDependencies.analyticsProvider.get()];\n\n          case 1:\n            analytics = _a.sent();\n            analytics.logEvent(eventType, {\n              /* eslint-disable camelcase */\n              message_id: data[CONSOLE_CAMPAIGN_ID],\n              message_name: data[CONSOLE_CAMPAIGN_NAME],\n              message_time: data[CONSOLE_CAMPAIGN_TIME],\n              message_device_time: Math.floor(Date.now() / 1000)\n              /* eslint-enable camelcase */\n\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return WindowController;\n}();\n\nfunction getEventType(messageType) {\n  switch (messageType) {\n    case MessageType.NOTIFICATION_CLICKED:\n      return 'notification_open';\n\n    case MessageType.PUSH_RECEIVED:\n      return 'notification_foreground';\n\n    default:\n      throw new Error();\n  }\n}\n\nfunction stripInternalFields(internalPayload) {\n  delete internalPayload.messageType;\n  delete internalPayload.isFirebaseMessaging;\n  return internalPayload;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration Object');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId', 'messagingSenderId'];\n  var options = app.options;\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: options.projectId,\n    apiKey: options.apiKey,\n    appId: options.appId,\n    senderId: options.messagingSenderId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MESSAGING_NAME = 'messaging';\n\nfunction factoryMethod(container) {\n  // Dependencies.\n  var app = container.getProvider('app').getImmediate();\n  var appConfig = extractAppConfig(app);\n  var installations = container.getProvider('installations').getImmediate();\n  var analyticsProvider = container.getProvider('analytics-internal');\n  var firebaseDependencies = {\n    app: app,\n    appConfig: appConfig,\n    installations: installations,\n    analyticsProvider: analyticsProvider\n  };\n\n  if (!isSupported()) {\n    throw ERROR_FACTORY.create(\"unsupported-browser\"\n    /* UNSUPPORTED_BROWSER */\n    );\n  }\n\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return new SwController(firebaseDependencies);\n  } else {\n    // Assume we are in the window context.\n    return new WindowController(firebaseDependencies);\n  }\n}\n\nvar NAMESPACE_EXPORTS = {\n  isSupported: isSupported\n};\nfirebase.INTERNAL.registerComponent(new Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\"\n/* PUBLIC */\n).setServiceProps(NAMESPACE_EXPORTS));\n\nfunction isSupported() {\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return isSWControllerSupported();\n  } else {\n    // Assume we are in the window context.\n    return isWindowControllerSupported();\n  }\n}\n/**\r\n * Checks to see if the required APIs exist.\r\n */\n\n\nfunction isWindowControllerSupported() {\n  return 'indexedDB' in window && indexedDB !== null && navigator.cookieEnabled && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window && 'fetch' in window && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\n\n\nfunction isSWControllerSupported() {\n  return 'indexedDB' in self && indexedDB !== null && 'PushManager' in self && 'Notification' in self && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}"],"sourceRoot":""}